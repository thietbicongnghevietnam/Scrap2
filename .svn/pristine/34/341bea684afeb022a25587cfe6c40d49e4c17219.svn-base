

@{
    ViewBag.Title = "Báo Cáo Hàng Hủy";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
    .warning-header {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .warning-icon {
        color: #f39c12;
        font-size: 24px;
        margin-right: 10px;
    }

    .warning-title {
        color: #2c3e50;
        font-size: 24px;
        font-weight: 600;
        margin: 0;
        display: inline-block;
    }

    .warning-subtitle {
        color: #7f8c8d;
        font-size: 14px;
        margin: 5px 0 0 34px;
    }

    .search-container {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 20px;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        align-items: center;
    }

    .form-group {
        flex: 1;
        position: relative;
    }

    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 14px;
        background-color: white;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

        .form-control:focus {
            border-color: #4f46e5;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25);
        }

        .form-control::placeholder {
            color: #6c757d;
        }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 16px;
    }

    .search-input {
        padding-left: 40px !important;
    }

    .filter-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 16px;
    }

    .filter-input {
        padding-left: 40px !important;
    }

    .date-input {
        padding-right: 40px !important;
    }

    .calendar-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 16px;
        pointer-events: none;
    }

    .btn-export {
        background-color: #4f46e5;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.15s ease-in-out;
    }

        .btn-export:hover {
            background-color: #4338ca;
        }

        .btn-export:focus {
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25);
        }

    .export-icon {
        font-size: 16px;
    }

    .export-container {
        display: flex;
        justify-content: center;
        margin-top: 10px;
    }

    /* media (max-width: 768px) {
                .form-row {
                    flex-direction: column;
                    gap: 15px;
                }

                .warning-title {
                    font-size: 20px;
                }

                .search-container {
                    padding: 20px;
                }
            } */
</style>


<div class="container mt-4">
    <!-- Warning Header -->
    <div class="warning-header">
        <div class="d-flex align-items-start">
            <img src="~/warning.svg" alt="Warning Icon" class="pr-2 " />
            <div>
                <h1 class="warning-title">Báo Cáo Hàng Hủy</h1>
                <p class="warning-subtitle">Quản lý và theo dõi danh sách hàng hóa đã hủy</p>
            </div>
        </div>
    </div>

    <!-- Search and Filter Form -->
    <div class="search-container">
        @using (Html.BeginForm("Index", "DamagedGoods", FormMethod.Get, new { @class = "damaged-goods-form" }))
        {
            <div class="form-row">
                <!-- Search Input -->
                <div class="form-group">
                    <img src="~/search.svg" alt="Warning Icon" class="fas search-icon" />
                    @Html.TextBox("searchTerm", ViewBag.SearchTerm as string, new
                        {
                            @class = "form-control search-input",
                            @placeholder = "Tìm kiếm theo tên sản phẩm...",
                            @autocomplete = "off"
                        })
                </div>

                <!-- Status Filter -->
                <div class="form-group">
                    <img src="~/filter.svg" alt="Warning Icon" class=" fas filter-icon " />
                    @Html.DropDownList("statusFilter", new SelectList(new List<object> {
                new { Value = "", Text = "Tất cả trạng thái" },
                new { Value = "pending", Text = "Chờ xử lý" },
                new { Value = "processing", Text = "Đang xử lý" },
                new { Value = "completed", Text = "Đã hoàn thành" },
                new { Value = "cancelled", Text = "Đã hủy" }
                }, "Value", "Text", ViewBag.StatusFilter), new
                        {
                            @class = "form-control filter-input"
                        })
                </div>

                <!-- Date Filter -->
                <div class="form-group">
                    @Html.TextBox("dateFilter", ViewBag.DateFilter as string, new
                        {
                            @class = "form-control date-input",
                            @type = "date",
                            @placeholder = "mm/dd/yyyy"
                        })
                </div>
            </div>

            <!-- Export Button -->
            <div class="export-container">
                <button type="button" class="btn-export" onclick="exportToExcel()">
                    <i class="fas fa-download export-icon"></i>
                    Xuất Excel
                </button>
            </div>
        }
    </div>

    <!-- Results Table (placeholder) -->
    <div class="results-container">
        <div class="card">
            <div class="card-body">
                <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Sản phẩm
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Danh mục
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Số lượng
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Ngày hủy
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Lý do
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Trạng thái
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Thiệt hại
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Van đền
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Hành động
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    @foreach (var item in Model)
                                    {
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-12 w-12">
                                                        <img class="h-12 w-12 rounded-lg object-cover"
                                                             src="@item.Images[0]"
                                                             alt="@item.ProductName" />
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900">
                                                            @item.ProductName
                                                        </div>
                                                        <div class="text-sm text-gray-500">
                                                            @item.Id
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                @item.Category
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                @item.Quantity @item.Unit
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                @item.DestroyDate.ToString("dd/MM/yyyy")
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                @item.Reason
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                                                    @item.Status
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">
                                                @item.Cost.ToString("C")
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                @item.Compensation.ToString("C") 
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewDetails(@item.Id)" class="text-blue-600 hover:text-blue-900 flex items-center gap-1">
                                                    <i class="fas fa-eye"></i> Chi tiết
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    @section Scripts {
        <script>
            var ModelReprot = [];

            $(document).ready(function () {
                // Auto-submit form when filters change
                $('.form-control').on('change', function () {
                    if ($(this).attr('name') !== 'searchTerm') {
                        $(this).closest('form').submit();
                    }
                });

                // Submit form on Enter key for search
                $('.search-input').on('keypress', function (e) {
                    if (e.which === 13) {
                        $(this).closest('form').submit();
                    }
                });
            });

            function exportToExcel() {
                // Get current form data
                var formData = $('.damaged-goods-form').serialize();

                // Create export URL with current filters
                var exportUrl = '@Url.Action("ExportToExcel", "DamagedGoods")' + '?' + formData;

                // Create temporary link and trigger download
                var link = document.createElement('a');
                link.href = exportUrl;
                link.download = 'DamagedGoods_' + new Date().toISOString().split('T')[0] + '.xlsx';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        </script>
    }
